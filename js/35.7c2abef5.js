(self["webpackChunkshenlan_tool"]=self["webpackChunkshenlan_tool"]||[]).push([[35],{69035:function(t,o,i){"use strict";i.r(o),i.d(o,{default:function(){return B}});var e=function(){var t=this,o=t._self._c;return o("div",{staticClass:"page"},[o("Card",{staticClass:"sl-pub-card"},[o("p",{attrs:{slot:"title"},slot:"title"},[t._v("图片裁剪")]),o("div",{staticClass:"img-cut-content"},[o("ImgCutter",{ref:"imgCutterModal",attrs:{label:"选择本地图片","file-type":"png","tool-bgc":"none","is-modal":!1,"show-choose-btn":!0,"lock-scroll":!0,"box-width":783,"box-height":458,"cut-width":250,"cut-height":250,"size-change":!0,"move-able":!0,"img-move":!0,"original-graph":!1,"small-to-upload":!0,"save-cut-position":!0,"scale-able":!0,"preview-mode":!0,quality:1,"tool-box-overflow":!0},on:{cutDown:t.cutDown}},[o("div",{staticClass:"btn btn-primary"},[t._v("选择本地图片")])])],1)])],1)},s=[],r=function(){var t=this,o=t._self._c;return o("div",[!0===t.showChooseBtn&&!0===t.isModal?o("div",{on:{click:t.handleOpen}},[t._t("openImgCutter"),t._t("open")],2):t._e(),t.$slots.openImgCutter||t.$slots.open||!0!==t.isModal?t._e():o("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.handleOpen}},[t._v(" "+t._s(t.label)+" ")]),o("transition",{attrs:{name:"fade"}},[t.visible?o("div",{ref:"mask",class:!0===t.isModal?"mask vue-img-cutter":""},[t.visible?o("div",{class:!0===t.isModal?"dialogBoxModal":"dialogBox"},[o("transition",{attrs:{name:"fade","enter-class":"fade-in-enter","enter-active-class":"fade-in-active","leave-class":"fade-out-enter","leave-active-class":"fade-out-active"}},[o("div",{ref:"dialogMainModalRef",class:!0===t.isModal?"dialogMainModal":"dialogMain",style:"width:"+(!0===t.isModal?t.boxWidth+32:t.boxWidth)+"px"},[o("div",{staticClass:"toolMain"},[!0===t.isModal?o("div",{staticClass:"tool-title"},[t._v(" 图片裁剪 "),o("span",{staticClass:"closeIcon",on:{click:t.handleClose}},[t._v("×")])]):t._e(),o("div",{ref:"toolBox",staticClass:"toolBox",style:"height:"+t.boxHeight+"px;width:"+t.boxWidth+"px",on:{mousemove:t.controlBtnMouseMove,mouseup:t.controlBtnMouseUp,mouseleave:t.controlBtnMouseUp}},[o("div",{directives:[{name:"show",rawName:"v-show",value:!t.drawImg.img&&!0===t.showChooseBtn,expression:"!drawImg.img && showChooseBtn === true"}],staticClass:"tips"},[o("div",{staticClass:"btn btn-warning btn-xs",on:{click:t.chooseImg}},[t._v(" "+t._s(t.label)+" ")])]),1==t.tool?o("div",{directives:[{name:"show",rawName:"v-show",value:t.drawImg.img&&!0!==t.dropImg.active&&1==t.controlBox.disable&&1==t.toolBox.disable,expression:"\n                                        drawImg.img &&\n                                        dropImg.active !== true &&\n                                        controlBox.disable == true &&\n                                        toolBox.disable == true\n                                    "}],staticClass:"dockMain",style:"background:"+t.toolBgc,on:{mouseenter:t.dropImgOff}},[t.rate?o("div",{staticClass:"dockBtn"},[t._t("ratio",(function(){return[t._v(" Ratio: ")]})),t._v(" "+t._s(t.rate)+" ")],2):t._e(),o("div",{staticClass:"dockBtn",on:{click:t.scaleReset}},[t._t("scaleReset",(function(){return[t._v(" Scale: ")]})),t._v(" "+t._s(t.drawImg.swidth>0?(t.drawImg.width/t.drawImg.swidth).toFixed(2):"-")+" ")],2),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:function(o){return t.turnImg(-90)}}},[t._t("turnLeft",(function(){return[t._v(" ↳ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:function(o){return t.turnImg(90)}}},[t._t("turnRight",(function(){return[t._v(" ↲ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:function(o){return t.turnReset()}}},[t._t("reset",(function(){return[t._v(" ↻ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtnScrollBar"},[o("div",{ref:"dockBtnScrollControl",staticClass:"scrollBarControl",style:"left:"+t.rotateControl.position+"px",on:{mousemove:t.scrollBarControlMove,mousedown:t.scrollBarControlOn,mouseleave:t.scrollBarControlOff,mouseup:t.scrollBarControlOff}}),1==t.rotateControl.active?o("div",{staticClass:"scrollBarText",style:"left:"+t.rotateControl.position+"px"},[t._v(" "+t._s(t.rotateImg.angle.toFixed(0)+"°")+" ")]):t._e()]):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:t.flipHorizontal}},[t._t("flipHorizontal",(function(){return[t._v(" ⇆ ")]}))],2):t._e(),!1===t.originalGraph?o("div",{staticClass:"dockBtn",on:{click:t.flipVertically}},[t._t("flipVertically",(function(){return[t._v(" ⇅ ")]}))],2):t._e()]):t._e(),o("div",{directives:[{name:"show",rawName:"v-show",value:null!=t.drawImg.img,expression:"drawImg.img != null"}],ref:"toolBoxControl",staticClass:"toolBoxControl",style:{pointerEvents:t.moveAble?"auto":"none"},on:{mousedown:t.toolBoxMouseDown,mouseup:t.toolBoxMouseUp,mousemove:t.toolBoxMouseMove,mouseleave:t.toolBoxMouseLeave}},[o("div",{staticClass:"toolBoxControlBox"},[o("div",{staticClass:"controlBox"},[o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineTop"}),o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineBottom"}),o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineLeft"}),o("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineRight"}),o("div",{staticClass:"selectArea"},[t._v(" 宽:"+t._s(t.showToolBoxWidth)+" 高:"+t._s(t.showToolBoxHeight)+" (x:"+t._s(t.showToolBoxX)+",y:"+t._s(t.showToolBoxY)+") ")]),!0===t.sizeChange?o("div",{staticClass:"leftUp controlBtn",attrs:{"data-name":"leftUp"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"leftUp")}}}):t._e(),!0===t.sizeChange?o("div",{staticClass:"leftDown controlBtn",attrs:{"data-name":"leftDown"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"leftDown")}}}):t._e(),!0===t.sizeChange?o("div",{staticClass:"rightUp controlBtn",attrs:{"data-name":"rightUp"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"rightUp")}}}):t._e(),!0===t.sizeChange?o("div",{staticClass:"rightDown controlBtn",attrs:{"data-name":"rightDown"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"rightDown")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.width>20?o("div",{staticClass:"topCenter controlBtn",attrs:{"data-name":"topCenter"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"topCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.width>20?o("div",{staticClass:"downCenter controlBtn",attrs:{"data-name":"downCenter"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"downCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.height>20?o("div",{staticClass:"leftCenter controlBtn",attrs:{"data-name":"leftCenter"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"leftCenter")}}}):t._e(),!0===t.sizeChange&&!t.rate&&t.toolBox.height>20?o("div",{staticClass:"rightCenter controlBtn",attrs:{"data-name":"rightCenter"},on:{mousedown:function(o){return t.controlBtnMouseDown(o,"rightCenter")}}}):t._e()]),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-1"}),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-2"}),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-3"}),o("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-4"})])]),o("div",{staticClass:"copyright"},[t.DoNotDisplayCopyright?t._e():o("a",{attrs:{target:"_blank",href:"https://github.com/acccccccb/vue-img-cutter",rel:"nofollow"}},[t._v(" vue-img-cutter "+t._s(t.version)+" ")])]),o("canvas",{ref:"canvasSelectBox",staticClass:"canvasSelectBox",attrs:{width:t.boxWidth,height:t.boxHeight},on:{mousedown:t.dropImgOn,mouseup:t.dropImgOff,mousemove:t.dropImgMove}}),o("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:t.boxWidth,height:t.boxHeight}})])]),o("div",{staticClass:"i-dialog-footer",staticStyle:{height:"40px"}},[o("input",{ref:"inputFile",staticStyle:{width:"1px",height:"1px",border:"none",opacity:"0"},attrs:{type:"file",accept:"image/gif, image/jpeg ,image/png"},on:{change:t.putImgToCanv}}),o("span",{on:{click:t.chooseImg}},[t._t("choose",(function(){return[!0===t.showChooseBtn?o("div",{staticClass:"btn btn-primary btn-primary-plain"},[t._v(" "+t._s(t.label)+" ")]):t._e()]}))],2),o("div",{staticClass:"btn-group fr"},[o("span",{on:{click:t.handleClose}},[t._t("cancel",(function(){return[o("button",{staticClass:"btn btn-default",attrs:{type:"button"}},[t._v("取消")])]}))],2),o("span",{on:{click:function(o){return t.cropPicture(!1)}}},[t._t("confirm",(function(){return[o("button",{staticClass:"btn btn-primary",staticStyle:{"margin-left":"15px"},attrs:{type:"button",disabled:!t.drawImg.img}},[t._v(" 确定 ")])]}))],2)])])])]),o("div",{staticStyle:{clear:"both"}})],1):t._e()]):t._e()])],1)},l=[],a=(i(82801),i(23767),i(8585),i(68696),{i8:"3.0.3"}),h={name:"ImgCutter",props:{crossOrigin:{type:Boolean,default:!1,required:!1},crossOriginHeader:{type:String,default:"*",required:!1},label:{type:String,default:"选择图片",required:!1},isModal:{type:Boolean,default:!0,required:!1},lockScroll:{type:Boolean,default:!0,required:!1},showChooseBtn:{type:Boolean,default:!0,required:!1},boxWidth:{type:Number,default:800,required:!1},boxHeight:{type:Number,default:400,required:!1},cutWidth:{type:Number,default:200,required:!1},cutHeight:{type:Number,default:200,required:!1},rate:{type:String,default:null,required:!1},tool:{type:Boolean,default:!0,required:!1},toolBgc:{type:String,default:"#fff",required:!1},imgMove:{type:Boolean,default:!0,required:!1},sizeChange:{type:Boolean,default:!0,required:!1},originalGraph:{type:Boolean,default:!1,required:!1},moveAble:{type:Boolean,default:!0,required:!1},previewMode:{type:Boolean,default:!0,required:!1},CuttingOriginal:{type:Boolean,default:!1,required:!1},WatermarkText:{type:String,default:"",required:!1},WatermarkTextFont:{type:String,default:"12px Sans-serif",required:!1},WatermarkTextColor:{type:String,default:"#fff",required:!1},WatermarkTextX:{type:Number,default:.95,required:!1},WatermarkTextY:{type:Number,default:.95,required:!1},smallToUpload:{type:Boolean,default:!1,required:!1},saveCutPosition:{type:Boolean,default:!1,required:!1},scaleAble:{type:Boolean,default:!0,required:!1},index:{default:null,required:!1},fileType:{default:"png",required:!1,type:String},toolBoxOverflow:{type:Boolean,default:!0,required:!1},DoNotDisplayCopyright:{type:Boolean,default:!1,required:!1},quality:{type:Number,default:1,required:!1}},model:["label","boxWidth","boxHeight","rate","tool","DoNotDisplayCopyright"],data(){let t,o;return t=this.boxWidth/2,o=this.boxHeight/2,{version:"",visible:!1,fileName:"",cutImageObj:null,onPrintImgTimmer:null,toolBoxPosition:{x:0,y:0},drawImg:{img:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},toolBox:{disable:!0,width:t,height:o,x:0,y:0,boxMove:{start:{x:0,y:0},moveTo:{x:0,y:0}}},dropImg:{active:!1,pageX:0,pageY:0,params:{}},rotateImg:{angle:0},rotateControl:{active:!1,start:{x:0,y:0},position:100},scaleImg:{rate:0,params:{}},controlBox:{disable:!0,btnName:"",start:{x:0,y:0,width:0,height:0}},selectBox:!1,selectBoxColor:"rgba(0,0,0,0.6)",isFlipHorizontal:!1,isFlipVertically:!1}},mounted(){this.version=a.i8,!1===this.isModal&&(this.visible=!0,this.$nextTick((()=>{this.$refs["toolBox"]&&(this.$refs["toolBox"].onmousewheel=this.scaleImgWheel,this.$refs["toolBox"].addEventListener("DOMMouseScroll",this.scaleImgWheel))})))},methods:{handleOpen(t){let o=t=>{if(this.$refs["toolBox"]&&(this.$refs["toolBox"].onmousewheel=this.scaleImgWheel,this.$refs["toolBox"].addEventListener("DOMMouseScroll",this.scaleImgWheel)),!0===this.isModal){!0===this.lockScroll&&(document.body.style.overflowY="hidden");let t=this.$refs["dialogMainModalRef"].offsetHeight+200,o=window.innerHeight,i=this.$refs["mask"];i.style.overflowY=t>o?"scroll":"hidden"}t&&"function"===typeof t&&t()};if(t&&"object"==typeof t&&t.src){if(!t.name)throw new Error("传入参数必须包含：src,name");{let i=new Image;!0===this.crossOrigin&&(i.crossOrigin=this.crossOriginHeader),i.name=t.name,i.style.position="fixed",i.style.top="-5000px",i.style.opacity=0,i.onerror=t=>{this.$emit("error",{index:this.index,event:t,msg:"图片加载失败"}),this.clearCutImageObj()},i.onload=()=>{if(!0!==i.complete)throw new Error("图片加载失败");this.visible=!0,this.$nextTick((()=>{o((()=>{this.importImgToCanv(i)}))}))},i.src=t.src,this.cutImageObj=i,document.body.appendChild(i),this.$emit("onChooseImg",t,this.index)}}else this.visible=!0,this.$nextTick((()=>{o()}))},handleClose(){this.clearAll(),!0===this.isModal&&(!0===this.lockScroll&&(document.body.style.overflowY="scroll"),this.$nextTick((()=>{this.visible=!1})))},chooseImg(){this.$refs["inputFile"].click()},importImgToCanv(t){let o,i=t.height,e=t.width,s=this.boxWidth,r=this.boxHeight,l={...this.drawImg};this.fileName=t.name,l.img=t,this.scaleImg.rate=e/i,i<r&&e<s?(o=1,l.x=(s-e)/2,l.y=(r-i)/2):e/i<=s/r?(o=r/i,l.x=(s-e*o)/2):(o=s/e,l.y=(r-i*o)/2),l.swidth=e,l.sheight=i,l.width=e*o,l.height=i*o,l.x=(s-l.width)/2,l.y=(r-l.height)/2,this.drawImg=l,this.printImg(),this.putToolBox()},putImgToCanv(t){let o;if(!t.target.files)return!1;if(o=t.target.files[0]||null,o){this.fileName=o.name;let t=new FileReader;t.readAsDataURL(o),t.onload=i=>{let e=i.target.result,s=document.createElement("img");s.src=e;let r=setInterval((()=>{if(2===t.readyState){if(clearInterval(r),!this.sizeChange&&this.smallToUpload&&s.width<=this.cutWidth&&s.height<=this.cutHeight)return this.handleClose(),o.name=this.changeFileName(o.name,this.fileType),void this.$emit("cutDown",{filename:this.changeFileName(o.name,this.fileType),file:o,index:this.index});let t,i=s.height,e=s.width,l=this.boxWidth,a=this.boxHeight,h={...this.drawImg};h.img=s,this.scaleImg.rate=e/i,i<a&&e<l?(t=1,h.x=(l-e)/2,h.y=(a-i)/2):e/i<=l/a?(t=a/i,h.x=(l-e*t)/2):(t=l/e,h.y=(a-i*t)/2),h.swidth=e,h.sheight=i,h.width=e*t,h.height=i*t,h.x=(l-h.width)/2,h.y=(a-h.height)/2,this.drawImg=h,this.printImg(),this.putToolBox()}}),200)},this.$emit("onChooseImg",o,this.index)}},putToolBox(){this.toolBox.width!==this.boxWidth/2&&this.toolBox.height!==this.boxHeight/2&&!1!==this.saveCutPosition||(this.toolBox.width=this.cutWidth>this.boxWidth?this.boxWidth:this.cutWidth,this.toolBox.height=this.cutHeight>this.boxHeight?this.boxHeight:this.cutHeight),(0===this.toolBox.x&&0===this.toolBox.y||!1===this.saveCutPosition)&&(this.toolBox.x=this.boxWidth/2-this.toolBox.width/2,this.toolBox.y=this.boxHeight/2-this.toolBox.height/2),this.checkToolBoxOverflow().then((()=>{this.printImg()})),this.drawControlBox(this.toolBox.width,this.toolBox.height,this.toolBox.x,this.toolBox.y)},checkToolBoxOverflow(){return new Promise((t=>{if(!this.toolBoxOverflow){if(this.drawImg.width<this.toolBox.width||this.drawImg.height<this.toolBox.height){const t=this.drawImg.width/this.drawImg.height;this.drawImg.width<this.toolBox.width&&(this.drawImg.width=this.toolBox.width,this.drawImg.height=this.drawImg.width/t),this.drawImg.height<this.toolBox.height&&(this.drawImg.height=this.toolBox.height,this.drawImg.width=this.drawImg.height*t),this.drawImg.x=(this.boxWidth-this.drawImg.width)/2,this.drawImg.y=(this.boxHeight-this.drawImg.height)/2}this.drawImg.x>this.toolBox.x&&(this.drawImg.x=this.toolBox.x),this.drawImg.x+this.drawImg.width<this.toolBox.x+this.toolBox.width&&(this.drawImg.x=this.toolBox.x+this.toolBox.width-this.drawImg.width),this.drawImg.y>this.toolBox.y&&(this.drawImg.y=this.toolBox.y),this.drawImg.y+this.drawImg.height<this.toolBox.y+this.toolBox.height&&(this.drawImg.y=this.toolBox.y+this.toolBox.height-this.drawImg.height)}t()}))},isSupportFileApi(){return!!(window.File&&window.FileList&&window.FileReader&&window.Blob&&-1===navigator.userAgent.indexOf("Edge")&&-1===navigator.userAgent.indexOf("MSIE")&&-1===navigator.userAgent.indexOf("Trident"))},dataURLtoFile(t,o){let i=t.split(","),e=i[0].match(/:(.*?);/)[1],s=atob(i[1]),r=s.length,l=new Uint8Array(r);while(r--)l[r]=s.charCodeAt(r);if(this.isSupportFileApi()){let t=new File([l],o,{type:e});return t}return"不支持File对象"},clearAll(){let t=this,o=t.$refs["canvas"],i=o.getContext("2d");i.clearRect(0,0,o.width,o.height);let e=t.$refs["canvasSelectBox"],s=e.getContext("2d");s.clearRect(0,0,e.width,e.height);let r=t.drawImg.sx,l=t.drawImg.sy;this.drawImg={img:null,sx:r,sy:l,swidth:0,sheight:0,x:0,y:0,width:0,height:0},this.isFlipHorizontal=!1,this.isFlipVertically=!1,this.$refs["inputFile"].value="",this.rotateImg.angle=0,this.drawImg.img=null,this.turnReset(),this.clearCutImageObj(),this.$emit("onClearAll",this.index)},clearCutImageObj(){null!==this.cutImageObj&&void 0!==this.cutImageObj&&("function"===typeof this.cutImageObj.remove?this.cutImageObj.remove():this.cutImageObj.removeNode()),this.cutImageObj=null},drawControlBox(t,o,i,e){this.toolBoxOverflow||(t<1&&(t=1),o<1&&(o=1),t>this.drawImg.width&&(t=this.drawImg.width),o>this.drawImg.height&&(o=this.drawImg.height),i<this.drawImg.x&&(i=this.drawImg.x),e<this.drawImg.y&&(e=this.drawImg.y),i>this.drawImg.x+this.drawImg.width-t&&(i=this.drawImg.x+this.drawImg.width-t),e>this.drawImg.y+this.drawImg.height-o&&(e=this.drawImg.y+this.drawImg.height-o)),t>this.boxWidth&&(t=this.boxWidth),o>this.boxHeight&&(o=this.boxHeight),i<0&&(i=0),e<0&&(e=0);let s,r,l=this.$refs["toolBoxControl"],a=this.$refs["canvasSelectBox"],h=a.getContext("2d");if(h.fillStyle=this.selectBoxColor,h.clearRect(0,0,a.width,a.height),h.fillRect(0,0,a.width,a.height),this.rate&&""!==this.rate){let i=this.rate.split(":")[0]/this.rate.split(":")[1];i>=1?(s=t,r=t/i,r+e>this.drawImg.y+this.drawImg.height&&(r=this.drawImg.y+this.drawImg.height-e,s=r*i)):(s=o*i,r=o)}else s=t,r=o;this.toolBox.width=Math.abs(s),this.toolBox.height=Math.abs(r),l.style.width=Math.abs(s)+"px",l.style.height=Math.abs(r)+"px",this.toolBox.boxMove.moveTo.x=i,this.toolBox.boxMove.moveTo.y=e,s<0&&(i+=s),r<0&&(e+=r),i+this.toolBox.width>this.boxWidth&&(i=this.boxWidth-this.toolBox.width),i<0&&(i=0),e+this.toolBox.height>this.boxHeight&&(e=this.boxHeight-this.toolBox.height),e<0&&(e=0),this.toolBoxPosition.x=i,this.toolBoxPosition.y=e,l.style.left=i+"px",l.style.top=e+"px",h.clearRect(i,e,Math.abs(s),Math.abs(r)),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)},resetToolBox(){this.toolBox.width<0&&(this.toolBox.boxMove.moveTo.x=this.toolBox.x-this.toolBox.width),this.toolBox.height<0&&(this.toolBox.boxMove.moveTo.y=this.toolBox.y-this.toolBox.height),this.toolBox.width=Math.abs(this.toolBox.width),this.toolBox.height=Math.abs(this.toolBox.height)},toolBoxMouseDown(t){let o=this.$refs["toolBoxControl"];this.toolBox.x=parseInt(o.style.left.split("px")[0]),this.toolBox.y=parseInt(o.style.top.split("px")[0]),this.toolBox.disable=!1,this.dropImg.active=!1,this.toolBox.boxMove.start={x:t.pageX,y:t.pageY}},toolBoxMouseMove(t){if(this.dropImg.active&&this.dropImgMove(t),!1===this.toolBox.disable&&!0===this.moveAble){let o=t.pageX-this.toolBox.boxMove.start.x,i=t.pageY-this.toolBox.boxMove.start.y,e=this.toolBox.x+o,s=this.toolBox.y+i;this.drawControlBox(this.toolBox.width,this.toolBox.height,e,s)}},toolBoxMouseLeave(){this.toolBox.disable=!0,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100),this.resetToolBox()},toolBoxMouseUp(){this.toolBox.x=parseInt(this.toolBoxPosition.x),this.toolBox.y=parseInt(this.toolBoxPosition.y),this.toolBox.disable=!0,this.dropImg.active=!1,this.resetToolBox()},printImg(){if(this.drawImg.img){let t=this.$refs["canvas"],o=t.getContext("2d");o.font="18px bold 黑体",o.fillStyle="#ff0",o.textAlign="center",o.textBaseline="middle",o.save(),o.clearRect(0,0,t.width,t.height),o.translate(this.drawImg.x+this.drawImg.width/2,this.drawImg.y+this.drawImg.height/2),o.rotate(this.rotateImg.angle*Math.PI/180),o.translate(-(this.drawImg.x+this.drawImg.width/2),-(this.drawImg.y+this.drawImg.height/2)),o.translate(this.drawImg.x,this.drawImg.y),o.scale(this.isFlipHorizontal?-1:1,this.isFlipVertically?-1:1),o.drawImage(this.drawImg.img,this.drawImg.sx,this.drawImg.sy,this.drawImg.swidth,this.drawImg.sheight,this.isFlipHorizontal?-this.drawImg.width:0,this.isFlipVertically?-this.drawImg.height:0,this.drawImg.width,this.drawImg.height),o.translate(-this.drawImg.x,this.drawImg.y),o.restore(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)}},dropImgOn(t){!0===this.imgMove&&(this.dropImg.active=!0,this.dropImg.params={...this.drawImg},this.dropImg.pageX=t.pageX,this.dropImg.pageY=t.pageY)},dropImgOff(){this.dropImg.active=!1,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)},dropImgMove(t){if(this.dropImg.active&&this.drawImg.img){let o={...this.drawImg};o.x=this.dropImg.params.x-(this.dropImg.pageX-t.pageX),o.y=this.dropImg.params.y-(this.dropImg.pageY-t.pageY),this.toolBoxOverflow||(o.x>this.toolBox.x&&(o.x=this.toolBox.x),o.x<this.toolBox.x+this.toolBox.width-o.width&&(o.x=this.toolBox.x+this.toolBox.width-o.width),o.y>this.toolBox.y&&(o.y=this.toolBox.y),o.y<this.toolBox.y+this.toolBox.height-o.height&&(o.y=this.toolBox.y+this.toolBox.height-o.height)),this.drawImg=o,this.printImg(),t.stopPropagation()}},scaleReset(){this.drawImg.width=this.drawImg.swidth,this.drawImg.height=this.drawImg.sheight,this.printImg()},scaleImgWheel(t){if(this.drawImg.img&&!0===this.scaleAble){let o,i=t||window.event;i.wheelDelta?o=-i.wheelDelta/40:i.detail&&(o=i.detail);let e=50;this.drawImg.x=this.drawImg.width-9*o>e?this.drawImg.x+3*o:this.drawImg.x,this.drawImg.y=this.drawImg.width-9*o>e?this.drawImg.y+3*o:this.drawImg.y,this.drawImg.width=this.drawImg.width-9*o>e?this.drawImg.width-9*o:e,this.drawImg.height=this.drawImg.width/this.scaleImg.rate,this.checkToolBoxOverflow().then((()=>{this.printImg(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)}))}return t.preventDefault(),t.returnValue=!1,!1},flipHorizontal(){this.drawImg.img&&(0==this.isFlipHorizontal?this.isFlipHorizontal=!0:this.isFlipHorizontal=!1,this.printImg())},flipVertically(){this.drawImg.img&&(0==this.isFlipVertically?this.isFlipVertically=!0:this.isFlipVertically=!1,this.printImg())},turnImg(t){let o=this.rotateImg.angle,i=o+t;i>=-180&&i<=180&&(this.rotateImg.angle=i,this.rotateControl.position=i/180*100+100,this.printImg("rotate"))},turnReset(){this.rotateImg.angle=0,this.rotateControl.position=100,this.printImg("rotate")},controlBtnMouseDown(t,o){this.controlBox.disable=!1,this.controlBox.btnName=o,this.controlBox.start.x=t.clientX,this.controlBox.start.y=t.clientY,this.controlBox.start.width=this.toolBox.width,this.controlBox.start.height=this.toolBox.height,t.stopPropagation()},controlBtnMouseUp(t){this.controlBox.disable=!0,this.dropImgOff(),this.resetToolBox(),this.toolBoxMouseUp(),t.stopPropagation()},controlBtnMouseMove(t){if(!1===this.controlBox.disable){let o,i,e=t.clientX-this.controlBox.start.x,s=t.clientY-this.controlBox.start.y;if("leftUp"==this.controlBox.btnName){if(this.rate){let t=this.rate.split(":")[0]/this.rate.split(":")[1];t>=1?(o=this.toolBox.x+e,i=this.toolBox.y+e/t):(o=this.toolBox.x+s*t,i=this.toolBox.y+s)}else o=this.toolBox.x+e,i=this.toolBox.y+s;this.toolBox.width=this.controlBox.start.width-e,this.toolBox.height=this.controlBox.start.height-s}if("rightUp"==this.controlBox.btnName){if(this.rate){let t=this.rate.split(":")[0]/this.rate.split(":")[1];t>=1?(o=this.toolBox.x,i=this.toolBox.y-e/t):(o=this.toolBox.x,i=this.toolBox.y+s)}else o=this.toolBox.x,i=this.toolBox.y+s;this.toolBox.width=this.controlBox.start.width+e,this.toolBox.height=this.controlBox.start.height-s}if("rightDown"==this.controlBox.btnName&&(o=this.toolBox.x,i=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+e,this.toolBox.height=this.controlBox.start.height+s),"leftDown"==this.controlBox.btnName){if(this.rate){let t=this.rate.split(":")[0]/this.rate.split(":")[1];t>=1?(o=this.toolBox.x+e,i=this.toolBox.y):(o=this.toolBox.x+-s*t,i=this.toolBox.y)}else o=this.toolBox.x+e,i=this.toolBox.y;this.toolBox.width=this.controlBox.start.width-e,this.toolBox.height=this.controlBox.start.height+s}"topCenter"==this.controlBox.btnName&&(o=this.toolBox.x,i=this.toolBox.y+s,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height-s),"downCenter"==this.controlBox.btnName&&(o=this.toolBox.x,i=this.toolBox.y,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height+s),"leftCenter"==this.controlBox.btnName&&(o=this.toolBox.x+e,i=this.toolBox.y,this.toolBox.width=this.controlBox.start.width-e,this.toolBox.height=this.controlBox.start.height),"rightCenter"==this.controlBox.btnName&&(o=this.toolBox.x,i=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+e,this.toolBox.height=this.controlBox.start.height),this.drawControlBox(this.toolBox.width,this.toolBox.height,o,i)}t.stopPropagation()},changeFileName(t,o){let i=t.lastIndexOf(".");return t.substr(0,i+1)+("jpeg"===o?"jpg":o)},cropPicture(t){let o=this;if(this.drawImg.img){let i=this.$refs["canvas"];if(this.WatermarkText&&!t){let t=i.getContext("2d");t.font=this.WatermarkTextFont,t.fillStyle=this.WatermarkTextColor,t.textAlign="right",t.textBaseline="bottom",t.fillText(this.WatermarkText,this.toolBox.x+this.toolBox.width*this.WatermarkTextX,this.toolBox.y+this.toolBox.height*this.WatermarkTextY)}let e=new Image;!0===this.crossOrigin&&(e.crossOrigin=this.crossOriginHeader),e.src=i.toDataURL(`image/${this.fileType}`,o.quality),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:(t,e,s)=>{window.atob?setTimeout((()=>{let r,l=atob(i.toDataURL(e,s).split(",")[1]),a=l.length,h=new Uint8Array(a);for(let t=0;t<a;t++)h[t]=l.charCodeAt(t);try{r=new Blob([h],{type:`image/${o.fileType}`})}catch(n){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"==n.name&&window.BlobBuilder){const t=window.BlobBuilder;let i=new t;i.append(h.buffer),r=i.getBlob(`image/${o.fileType}`)}"InvalidStateError"==n.name&&(r=new Blob([h.buffer],{type:`image/${o.fileType}`}))}t(r)}),200):t(!1,{type:`image/${o.fileType}`})}}),i.toBlob((i=>{if(i){let s=new FileReader;s.readAsDataURL(i),s.onload=()=>{let i=setInterval((()=>{if(2==s.readyState){clearInterval(i);let s=document.createElement("canvas"),r=s.getContext("2d");if(1==o.originalGraph){let t=o.drawImg.width/o.drawImg.swidth,i=o.toolBox.width/t,e=o.toolBox.height/t;s.width=i,s.height=e;let l=(o.toolBox.x-o.drawImg.x)/t,a=(o.toolBox.y-o.drawImg.y)/t,h=o.drawImg.swidth,n=o.drawImg.sheight;r.translate(-l,-a),r.drawImage(o.drawImg.img,0,0,h,n)}else{s.width=o.toolBox.width,s.height=o.toolBox.height;let t=o.toolBox;if(o.rate){let i=o.rate.split(":")[0]/o.rate.split(":")[1],s=o.rate.split(":")[0],l=o.rate.split(":")[1];s>=l?r.drawImage(e,t.x,t.y,t.width,t.width*i,0,0,t.width,t.width*i):r.drawImage(e,t.x,t.y,t.width,t.width/i,0,0,t.width,t.width/i)}else r.drawImage(e,t.x,t.y,t.width,t.height,0,0,t.width,t.height)}s.toBlob((i=>{let e=o.changeFileName(o.fileName,o.fileType);t?o.previewMode&&o.$emit("onPrintImg",{index:o.index,fileName:e,blob:i,file:o.dataURLtoFile(s.toDataURL(`image/${o.fileType}`,o.quality),e),dataURL:s.toDataURL(`image/${o.fileType}`,o.quality)}):(o.handleClose(),o.$emit("cutDown",{index:o.index,fileName:e,blob:i,file:o.dataURLtoFile(s.toDataURL(`image/${o.fileType}`,o.quality),e),dataURL:s.toDataURL(`image/${o.fileType}`,o.quality)}))}),`image/${o.fileType}`,o.quality)}}),200)}}else{let i=document.createElement("canvas");i.width=o.toolBox.width,i.height=o.toolBox.height;let s=i.getContext("2d"),r=o.toolBox;if(o.rate){let t=o.rate.split(":")[0]/o.rate.split(":")[1];s.drawImage(e,r.x,r.y,r.width,r.width*t,0,0,r.width,r.width*t)}else s.drawImage(e,r.x,r.y,r.width,r.height,0,0,r.width,r.height);let l=o.changeFileName(o.fileName,o.fileType);t?o.$emit("onPrintImg",{fileName:l,dataURL:i.toDataURL(`image/${o.fileType}`,o.quality)}):(o.handleClose(),o.$emit("cutDown",{fileName:l,dataURL:i.toDataURL(`image/${o.fileType}`,o.quality)}))}})),o.fileType,o.quality}else t||o.$emit("error",{err:1,msg:"No picture selected"})},scrollBarControlMove(t){if(this.rotateControl.active){let o=t.pageX-this.rotateControl.start.x,i=this.rotateControl.start.position+o;i<=0&&(i=0),i>=200&&(i=200),this.rotateControl.position=i,this.rotateImg.angle=(i-100)/100*180,this.printImg()}},scrollBarControlOn(t){this.rotateControl.active=!0,this.rotateControl.start.x=t.pageX,this.rotateControl.start.y=t.pageY,this.rotateControl.start.position=this.rotateControl.position},scrollBarControlOff(){this.rotateControl.active=!1}},computed:{showToolBoxWidth(){let t;return t=this.originalGraph?this.toolBox.width/(this.drawImg.width/this.drawImg.swidth):this.toolBox.width,Number(t).toFixed(0)},showToolBoxHeight(){let t;return t=this.originalGraph?this.toolBox.height/(this.drawImg.width/this.drawImg.swidth):this.toolBox.height,Number(t).toFixed(0)},showToolBoxX(){let t;return t=this.toolBoxPosition.x,Number(t).toFixed(0)},showToolBoxY(){let t;return t=this.toolBoxPosition.y,Number(t).toFixed(0)}}},n=h,d=i(43736),g=(0,d.Z)(n,r,l,!1,null,"f12f3d48",null),c=g.exports,m=c,x=i(14836),w={components:{ImgCutter:m},mixins:[],data(){return{}},computed:{},watch:{},beforeDestroy(){},mounted(){this.$nextTick((()=>{}))},methods:{cutDown(t){let o=new Image;o.src=t.dataURL,(0,x.sd)(o)}}},u=w,p=(0,d.Z)(u,e,s,!1,null,"4fc4abac",null),B=p.exports},14836:function(t,o,i){"use strict";i.d(o,{sd:function(){return s},yc:function(){return e}});const e=t=>new Promise(((o,i)=>{try{let i=new FileReader;i.readAsDataURL(t),i.onload=function(t){var i=new Image;i.src=t.target.result,o(i)}}catch(e){i(e)}})),s=(t,o)=>{o||(o="水印");let i=document.createElement("a");i.setAttribute("href",t.src),i.setAttribute("download","download"),i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i)}},25787:function(t,o,i){var e=i(47976),s=TypeError;t.exports=function(t,o){if(e(o,t))return t;throw s("Incorrect invocation")}},93678:function(t){t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},11060:function(t,o,i){var e=i(1702),s=Error,r=e("".replace),l=function(t){return String(s(t).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,h=a.test(l);t.exports=function(t,o){if(h&&"string"==typeof t&&!s.prepareStackTrace)while(o--)t=r(t,a,"");return t}},79587:function(t,o,i){var e=i(60614),s=i(70111),r=i(27674);t.exports=function(t,o,i){var l,a;return r&&e(l=o.constructor)&&l!==i&&s(a=l.prototype)&&a!==i.prototype&&r(t,a),t}},56277:function(t,o,i){var e=i(41340);t.exports=function(t,o){return void 0===t?arguments.length<2?"":o:e(t)}},41340:function(t,o,i){var e=i(70648),s=String;t.exports=function(t){if("Symbol"===e(t))throw TypeError("Cannot convert a Symbol value to a string");return s(t)}},82801:function(t,o,i){"use strict";var e=i(82109),s=i(17854),r=i(35005),l=i(79114),a=i(3070).f,h=i(92597),n=i(25787),d=i(79587),g=i(56277),c=i(93678),m=i(11060),x=i(19781),w=i(31913),u="DOMException",p=r("Error"),B=r(u),I=function(){n(this,f);var t=arguments.length,o=g(t<1?void 0:arguments[0]),i=g(t<2?void 0:arguments[1],"Error"),e=new B(o,i),s=p(o);return s.name=u,a(e,"stack",l(1,m(s.stack,1))),d(e,this,I),e},f=I.prototype=B.prototype,y="stack"in p(u),v="stack"in new B(1,2),b=B&&x&&Object.getOwnPropertyDescriptor(s,u),C=!!b&&!(b.writable&&b.configurable),T=y&&!C&&!v;e({global:!0,constructor:!0,forced:w||T},{DOMException:T?I:B});var _=r(u),R=_.prototype;if(R.constructor!==_)for(var E in w||a(R,"constructor",l(1,_)),c)if(h(c,E)){var M=c[E],D=M.s;h(_,D)||a(_,D,l(6,M.c))}}}]);