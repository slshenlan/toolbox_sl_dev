"use strict";(self["webpackChunkshenlan_tool"]=self["webpackChunkshenlan_tool"]||[]).push([[456],{10456:function(t,i,e){e.r(i),e.d(i,{default:function(){return l}});var a=function(){var t=this,i=t._self._c;return i("div",{staticClass:"page"},[i("Card",{staticClass:"sl-pub-card"},[i("p",{attrs:{slot:"title"},slot:"title"},[t._v("添加水印")]),i("div",{staticClass:"card-extra",attrs:{slot:"extra"},slot:"extra"},[i("Upload",{attrs:{multiple:"",format:["jpg","jpeg","png","webp"],action:"",accept:"image","before-upload":t.handleBeforeUpload}},[i("Button",{attrs:{type:"success"}},[t._v("上传图片")])],1),i("Button",{staticClass:"sl-margin-left-10",attrs:{type:"primary"},on:{click:function(i){t.drawer.show=!0}}},[t._v("设置")])],1),i("div",t._l(t.imgList,(function(t,e){return i("div",{key:e,staticClass:"img-item",style:{width:t.width+32+"px"}},[i("canvas",{ref:"refCanvas"+e,refInFor:!0,staticClass:"img-canvas",attrs:{width:t.width,height:t.height}})])})),0)]),i("Drawer",{attrs:{"mask-style":t.drawer.maskStyle,width:300,title:"属性栏",placement:"right"},model:{value:t.drawer.show,callback:function(i){t.$set(t.drawer,"show",i)},expression:"drawer.show"}},[i("div",{staticClass:"option-bar"},[i("Form",{attrs:{"label-width":70}},[i("FormItem",{attrs:{label:"水印图片"}},[i("Upload",{ref:"upload",staticStyle:{display:"inline-block",width:"30px","margin-right":"20px"},attrs:{"show-upload-list":!1,format:["jpg","jpeg","png"],"max-size":2048,type:"drag",action:"","before-upload":t.handleWaterMarkIconUpload}},[i("div",{staticStyle:{width:"30px",height:"30px","line-height":"35px"}},[i("Icon",{attrs:{type:"md-images",size:"20"}})],1)]),i("br"),i("img",{directives:[{name:"show",rawName:"v-show",value:t.form.icon,expression:"form.icon"}],ref:"iconPrev",staticClass:"water-mark-img"})],1),i("FormItem",{attrs:{label:"位置"}},[i("Select",{staticStyle:{width:"200px"},model:{value:t.form.type,callback:function(i){t.$set(t.form,"type",i)},expression:"form.type"}},[i("Option",{attrs:{value:10}},[t._v("铺满")]),i("Option",{attrs:{value:1}},[t._v("左上")]),i("Option",{attrs:{value:2}},[t._v("左中")]),i("Option",{attrs:{value:3}},[t._v("左下")]),i("Option",{attrs:{value:4}},[t._v("右上")]),i("Option",{attrs:{value:5}},[t._v("右中")]),i("Option",{attrs:{value:6}},[t._v("右下")]),i("Option",{attrs:{value:7}},[t._v("中上")]),i("Option",{attrs:{value:8}},[t._v("中间")]),i("Option",{attrs:{value:9}},[t._v("中下")])],1)],1),i("FormItem",{attrs:{label:"水印大小"}},[i("Slider",{attrs:{max:500,min:20,step:5},model:{value:t.form.iconSize,callback:function(i){t.$set(t.form,"iconSize",i)},expression:"form.iconSize"}})],1),i("FormItem",{attrs:{label:"透明度"}},[i("Slider",{attrs:{max:100,min:10},model:{value:t.form.globalAlpha,callback:function(i){t.$set(t.form,"globalAlpha",i)},expression:"form.globalAlpha"}})],1),i("FormItem",{attrs:{label:"上下间距"}},[i("Slider",{attrs:{max:500,min:0},model:{value:t.form.horizontalSpacing,callback:function(i){t.$set(t.form,"horizontalSpacing",i)},expression:"form.horizontalSpacing"}})],1),i("FormItem",{attrs:{label:"左右间距"}},[i("Slider",{attrs:{max:500,min:0},model:{value:t.form.portraitSpacing,callback:function(i){t.$set(t.form,"portraitSpacing",i)},expression:"form.portraitSpacing"}})],1),i("FormItem",{attrs:{label:"旋转角度"}},[i("Slider",{attrs:{max:180,min:-180,step:5},model:{value:t.form.rotateAngle,callback:function(i){t.$set(t.form,"rotateAngle",i)},expression:"form.rotateAngle"}})],1)],1),i("div",[i("Button",{attrs:{type:"primary"},on:{click:t.handleExportImage}},[t._v("导出图片")])],1)],1)])],1)},r=[],o=e(41719),s=o.Z,n=e(43736),h=(0,n.Z)(s,a,r,!1,null,null,null),l=h.exports},41719:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(57658),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),jszip__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(27954),jszip__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(jszip__WEBPACK_IMPORTED_MODULE_1__),jszip_vendor_FileSaver_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(93640),jszip_vendor_FileSaver_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(jszip_vendor_FileSaver_js__WEBPACK_IMPORTED_MODULE_2__),_pub_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14836);__webpack_exports__["Z"]={components:{},inject:["reload"],data(){return{drawer:{show:!1,maskStyle:{backgroundColor:"transparent"}},imgList:[],form:{iconSize:50,globalAlpha:100,type:10,portraitSpacing:20,horizontalSpacing:20,rotateAngle:0,icon:void 0}}},computed:{iconSize(){let t={width:this.form.iconSize,height:this.form.iconSize};const i=this.form.icon;if(!i)return!1;if(i.width>i.height){const e=i.width/i.height;t.height=t.width/e}else{const e=i.height/i.width;t.width=t.height/e}return t}},watch:{form:{handler(){this.slDebounce||(this.slDebounce=this.$pub.slDebounce((()=>{this.imgList.length&&this.form.icon&&this.imgList.forEach(((t,i)=>{this.renderImg(i,t)}))}))),this.slDebounce()},deep:!0,immediate:!1}},mounted(){},methods:{resetPage(){this.reload()},handleWaterMarkIconUpload(t){(0,_pub_js__WEBPACK_IMPORTED_MODULE_3__.yc)(t).then((t=>{this.form.icon=t,this.$refs.iconPrev.src=t.src}))},handleBeforeUpload(t){return(0,_pub_js__WEBPACK_IMPORTED_MODULE_3__.yc)(t).then((i=>{i.onload=()=>{let e={img:i,fileName:t.name,width:i.width,height:i.height};this.imgList.push(e),this.$nextTick((()=>{this.renderImg(this.imgList.length-1,e)}))}})),!1},getCanvas(index){let canvas=eval("this.$refs.refCanvas"+index)[0];return canvas},renderImg(t,i){let e=this.getCanvas(t),a=i.width,r=i.height,o=e.getContext("2d");o.clearRect(0,0,a,r),o.globalAlpha=1,o.drawImage(i.img,0,0,a,r),this.renderIcon(o,i)},renderIcon(t,i){if(this.form.icon){let e=this.handlePosition(i);t.globalAlpha=this.form.globalAlpha/100,t.translate(e.center.x,e.center.y),t.rotate(Math.PI/180*this.form.rotateAngle);for(let i=0;i<e.points.length;i++){const a=e.points[i];t.drawImage(this.form.icon,a.x,a.y,this.iconSize.width,this.iconSize.height)}t.rotate(Math.PI/180*this.form.rotateAngle*-1),t.translate(-1*e.center.x,-1*e.center.y)}},handlePosition(t){let i,e=[],a=t.width,r=t.height;if(1==this.form.type){i={x:0,y:0};let t={x:this.form.portraitSpacing,y:this.form.horizontalSpacing};e.push(t)}if(2==this.form.type){i={x:0,y:r/2};let t={x:this.form.portraitSpacing,y:this.form.horizontalSpacing-this.iconSize.height/2};e.push(t)}if(3==this.form.type){i={x:0,y:r};let t={x:this.form.portraitSpacing,y:-1*(this.form.horizontalSpacing+this.iconSize.height)};e.push(t)}if(4==this.form.type){i={x:a,y:0};let t={x:-1*(this.form.portraitSpacing+this.iconSize.width),y:this.form.horizontalSpacing};e.push(t)}if(5==this.form.type){i={x:a,y:r/2};let t={x:-1*(this.form.portraitSpacing+this.iconSize.width),y:this.form.horizontalSpacing-this.iconSize.height/2};e.push(t)}if(6==this.form.type){i={x:a,y:r};let t={x:-1*(this.form.portraitSpacing+this.iconSize.width),y:-1*(this.form.horizontalSpacing+this.iconSize.height)};e.push(t)}if(7==this.form.type){i={x:a/2,y:0};let t={x:this.form.portraitSpacing-this.iconSize.width/2,y:this.form.horizontalSpacing};e.push(t)}if(8==this.form.type){i={x:a/2,y:r/2};let t={x:this.form.portraitSpacing-this.iconSize.width/2,y:this.form.horizontalSpacing-this.iconSize.height/2};e.push(t)}if(9==this.form.type){i={x:a/2,y:r};let t={x:this.form.portraitSpacing-this.iconSize.width/2,y:-1*(this.form.horizontalSpacing+this.iconSize.height)};e.push(t)}if(10==this.form.type){i={x:a/2,y:r/2};const t=this.iconSize.width+this.form.portraitSpacing,s=this.iconSize.height+this.form.horizontalSpacing;var o=Math.sqrt(Math.pow(a,2)+Math.pow(r,2))/2;let n=-1*o;while(n<o){let i=-1*o;while(i<o)e.push({x:i,y:n}),i+=t;n+=s}}return{points:e,center:i}},handleExportImage(){try{if(!this.imgList.length)throw"请选择需要添加水印的图片";if(!this.form.icon)throw"请选择需要添加的水印图片";this.$Spin.show({render:t=>t("div",[t("Icon",{class:"demo-spin-icon-load",props:{type:"ios-loading",size:18}}),t("div","Loading")])}),this.renderExportImage()}catch(t){this.$Message.warning(t)}},renderExportImage(){const t=new(jszip__WEBPACK_IMPORTED_MODULE_1___default()),i=t.folder("images");this.imgList.forEach(((e,a)=>{let r=this.getCanvas(a);i.file(e.fileName,r.toDataURL("image/jpeg",1).substring(22),{base64:!0}),a===this.imgList.length-1&&(this.$Spin.hide(),t.generateAsync({type:"blob"}).then((function(t){jszip_vendor_FileSaver_js__WEBPACK_IMPORTED_MODULE_2___default()(t,"watermask.zip")})))}))}}}}}]);